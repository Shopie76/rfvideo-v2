<!DOCTYPE html>
<html lang="bn">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>‡¶π‡¶ø‡¶≤‡¶´‡ßÅ‡¶≤ ‡¶´‡ßÅ‡¶ú‡ßÅ‡¶≤ ‡¶∏‡ßÅ‡¶®‡ßç‡¶®‡¶ø ‡¶Ø‡ßÅ‡¶¨ ‡¶´‡¶æ‡¶â‡¶®‡ßç‡¶°‡ßá‡¶∂‡¶® ‚Äì ‡¶´‡¶∞‡¶Æ + ‡¶Ü‡¶á‡¶°‡¶ø ‡¶ï‡¶æ‡¶∞‡ßç‡¶°</title>
  <style>
    *{ -webkit-print-color-adjust: exact; print-color-adjust: exact; box-sizing: border-box }
    body{ font-family:'Noto Sans Bengali',system-ui,-apple-system,Segoe UI,Roboto,Arial; background:#f3f4f6; margin:0 }
    .wrap{ max-width:760px; margin:0 auto; padding:16px }
    .card{ background:#fff; border:1px solid #e5e7eb; border-radius:16px; padding:16px; box-shadow:0 1px 2px rgba(0,0,0,.06) }
    h1{ margin:0 0 6px 0; font-size:22px; color:#111827 }
    .muted{ color:#6b7280; font-size:12px; margin-bottom:8px }
    label{ display:block; margin:10px 0 6px; font-weight:600; font-size:14px }
    input,select{ width:100%; padding:10px 12px; border-radius:10px; border:1px solid #e5e7eb; font-size:14px; background:#fff; outline:none }
    button{ appearance:none; border:none; border-radius:12px; padding:12px 16px; font-weight:700; cursor:pointer }
    .primary{ background:#4f46e5; color:#fff } .ghost{ background:#eef2ff; color:#111827 }
    .row{ display:grid; grid-template-columns:1fr 1fr; gap:12px } @media(max-width:520px){ .row{ grid-template-columns:1fr } }
    .bar{ background:#fffbe6; border-bottom:1px solid #fde68a; padding:10px 12px; display:flex; gap:8px; align-items:center; }
    .bar input{ flex:1; border:1px dashed #f59e0b; border-radius:8px; padding:8px 10px }
    .id-wrap{ display:flex; flex-direction:column; align-items:center; gap:10px }
    .id-card{ width:360px; height:250px; border-radius:16px; overflow:hidden; position:relative;
      background:linear-gradient(135deg,#4f46e5,#2563eb); color:#fff; border:1px solid #e5e7eb; box-shadow:0 2px 6px rgba(0,0,0,.08) }
    .id-head{ display:flex; gap:10px; align-items:center; padding:10px 12px; background:rgba(255,255,255,.08) }
    .badge{ width:40px; height:40px; border-radius:10px; display:grid; place-items:center; background:rgba(255,255,255,.25); font-weight:800 }
    .org{ font-weight:800; line-height:1.1 } .addr{ font-size:11px; opacity:.95 } .sub{ font-size:11px; opacity:.9 }
    .meta{ display:flex; justify-content:space-between; font-size:11px; padding:4px 12px 0 12px; color:rgba(255,255,255,.95) }
    .body{ display:grid; grid-template-columns:100px 1fr; gap:8px; padding:8px 12px }
    .photo{ width:92px; height:92px; border-radius:50%; overflow:hidden; border:2px solid rgba(255,255,255,.6);
      background:rgba(255,255,255,.2); display:grid; place-items:center; font-size:12px; text-align:center }
    .photo img{ width:100%; height:100%; object-fit:cover }
    .row2{ display:grid; grid-template-columns:100px 1fr; gap:6px; font-size:12px; line-height:1.25 }
    .label{ color:rgba(255,255,255,.9) } .val{ font-weight:700 }
    .signs{ position:absolute; left:0; right:0; bottom:6px; padding:0 12px; display:grid; grid-template-columns:1fr 1fr 1fr; gap:10px }
    .sign{ text-align:center; color:#fff; font-size:10px }
    .sign img{ max-height:28px; max-width:110px; object-fit:contain; display:block; margin:0 auto 2px }
    .sign .line{ border-top:1px solid rgba(255,255,255,.7); padding-top:2px; font-weight:700; font-size:11px }
    .actions{ display:flex; gap:10px; flex-wrap:wrap } .hint{ font-size:12px; color:#6b7280 }
    @media print{ body *{visibility:hidden} #print-area, #print-area *{visibility:visible} #print-area{ position:absolute; inset:0; margin:auto; width:fit-content; height:fit-content } .no-print{ display:none!important } }
  </style>
</head>
<body>
  <div class="bar" id="sheetBar" style="display:none">
    <div>üóÇÔ∏è Google Sheet URL:</div>
    <input id="sheetInput" placeholder="https://script.google.com/macros/s/‚Ä¶/exec">
    <button id="sheetSave" class="primary">Save</button>
  </div>

  <div class="wrap">
    <div class="card">
      <h1>‡¶π‡¶ø‡¶≤‡¶´‡ßÅ‡¶≤ ‡¶´‡ßÅ‡¶ú‡ßÅ‡¶≤ ‡¶∏‡ßÅ‡¶®‡ßç‡¶®‡¶ø ‡¶Ø‡ßÅ‡¶¨ ‡¶´‡¶æ‡¶â‡¶®‡ßç‡¶°‡ßá‡¶∂‡¶®</h1>
      <div class="muted">‡¶†‡¶ø‡¶ï‡¶æ‡¶®‡¶æ: ‡¶ï‡¶≤‡¶∏‡¶ø ‡¶¶‡¶ø‡¶ò‡ßÄ ‡¶™‡¶ï‡ßá‡¶ü ‡¶ó‡ßá‡¶á‡¶ü ‡¶∏‡¶Ç‡¶≤‡¶ó‡ßç‡¶® ‡¶¨‡¶®‡ßç‡¶¶‡¶∞, ‡¶ö‡¶ü‡ßç‡¶ü‡¶ó‡ßç‡¶∞‡¶æ‡¶Æ ‚Ä¢ ‡¶∏‡¶æ‡¶¨‡¶Æ‡¶ø‡¶ü‡ßá‡¶∞ ‡¶∏‡¶æ‡¶•‡ßá ‡¶∏‡¶æ‡¶•‡ßá ‡¶∞‡¶ô‡¶ø‡¶® ‡¶Ü‡¶á‡¶°‡¶ø ‡¶ï‡¶æ‡¶∞‡ßç‡¶°</div>

      <form id="memberForm" name="hfsyfForm">
        <div class="row">
          <div><label>‡¶™‡ßÇ‡¶∞‡ßç‡¶£ ‡¶®‡¶æ‡¶Æ</label><input name="fullName" required placeholder="‡¶®‡¶æ‡¶Æ ‡¶≤‡¶ø‡¶ñ‡ßÅ‡¶®"></div>
          <div><label>‡¶™‡¶ø‡¶§‡¶æ‡¶∞ ‡¶®‡¶æ‡¶Æ</label><input name="fatherName" required placeholder="‡¶™‡¶ø‡¶§‡¶æ‡¶∞ ‡¶®‡¶æ‡¶Æ"></div>
        </div>
        <div class="row">
          <div><label>‡¶ú‡¶®‡ßç‡¶Æ ‡¶§‡¶æ‡¶∞‡¶ø‡¶ñ</label><input type="date" name="dob" required></div>
          <div><label>‡¶ú‡¶æ‡¶§‡ßÄ‡ßü ‡¶™‡¶∞‡¶ø‡¶ö‡ßü‡¶™‡¶§‡ßç‡¶∞ / ‡¶ú‡¶®‡ßç‡¶Æ‡¶®‡¶ø‡¶¨‡¶®‡ßç‡¶ß‡¶®</label><input name="nid" required placeholder="NID/BRC ‡¶®‡¶Æ‡ßç‡¶¨‡¶∞"></div>
        </div>
        <div class="row">
          <div>
            <label>‡¶∞‡¶ï‡ßç‡¶§‡ßá‡¶∞ ‡¶ó‡ßç‡¶∞‡ßÅ‡¶™</label>
            <select name="blood" required>
              <option>A+</option><option>A-</option><option>B+</option><option>B-</option>
              <option>O+</option><option>O-</option><option>AB+</option><option>AB-</option>
            </select>
          </div>
          <div><label>‡¶Æ‡ßã‡¶¨‡¶æ‡¶á‡¶≤</label><input name="mobile" required placeholder="01XXXXXXXXX"></div>
        </div>
        <div class="row">
          <div><label>‡¶†‡¶ø‡¶ï‡¶æ‡¶®‡¶æ</label><input name="address" required placeholder="‡¶†‡¶ø‡¶ï‡¶æ‡¶®‡¶æ"></div>
          <div><label>‡¶õ‡¶¨‡¶ø ‡¶Ü‡¶™‡¶≤‡ßã‡¶° (‡¶ê‡¶ö‡ßç‡¶õ‡¶ø‡¶ï)</label><input type="file" id="photo" accept="image/*"></div>
        </div>
        <div class="row">
          <div><label>‡¶≤‡ßã‡¶ó‡ßã (‡¶ê‡¶ö‡ßç‡¶õ‡¶ø‡¶ï)</label><input type="file" id="logo" accept="image/*"></div>
          <div><label>‡¶∏‡¶≠‡¶æ‡¶™‡¶§‡¶ø‡¶∞ ‡¶∏‡ßç‡¶¨‡¶æ‡¶ï‡ßç‡¶∑‡¶∞ (‡¶á‡¶Æ‡ßá‡¶ú)</label><input type="file" id="signPresident" accept="image/*"></div>
        </div>
        <div class="row">
          <div><label>‡¶∏‡ßá‡¶ï‡ßç‡¶∞‡ßá‡¶ü‡¶æ‡¶∞‡¶ø‡¶∞ ‡¶∏‡ßç‡¶¨‡¶æ‡¶ï‡ßç‡¶∑‡¶∞ (‡¶á‡¶Æ‡ßá‡¶ú)</label><input type="file" id="signSecretary" accept="image/*"></div>
          <div><label>‡¶∏‡¶¶‡¶∏‡ßç‡¶Ø‡ßá‡¶∞ ‡¶∏‡ßç‡¶¨‡¶æ‡¶ï‡ßç‡¶∑‡¶∞ (‡¶á‡¶Æ‡ßá‡¶ú)</label><input type="file" id="signMember" accept="image/*"></div>
        </div>
        <div style="margin-top:12px"><button class="primary" type="submit">‡¶∏‡¶æ‡¶¨‡¶Æ‡¶ø‡¶ü ‡¶ï‡¶∞‡ßÅ‡¶® ‡¶ì ‡¶Ü‡¶á‡¶°‡¶ø ‡¶ï‡¶æ‡¶∞‡ßç‡¶° ‡¶§‡ßà‡¶∞‡¶ø ‡¶ï‡¶∞‡ßÅ‡¶®</button></div>
      </form>
    </div>

    <div class="card" style="margin-top:12px">
      <div class="id-wrap">
        <div id="print-area">
          <div class="id-card" id="idCard">
            <div class="id-head">
              <div class="badge" id="badge">HF</div>
              <div>
                <div class="org">‡¶π‡¶ø‡¶≤‡¶´‡ßÅ‡¶≤ ‡¶´‡ßÅ‡¶ú‡ßÅ‡¶≤ ‡¶∏‡ßÅ‡¶®‡ßç‡¶®‡¶ø ‡¶Ø‡ßÅ‡¶¨ ‡¶´‡¶æ‡¶â‡¶®‡ßç‡¶°‡ßá‡¶∂‡¶®</div>
                <div class="addr">‡¶ï‡¶≤‡¶∏‡¶ø ‡¶¶‡¶ø‡¶ò‡ßÄ ‡¶™‡¶ï‡ßá‡¶ü ‡¶ó‡ßá‡¶á‡¶ü ‡¶∏‡¶Ç‡¶≤‡¶ó‡ßç‡¶® ‡¶¨‡¶®‡ßç‡¶¶‡¶∞, ‡¶ö‡¶ü‡ßç‡¶ü‡¶ó‡ßç‡¶∞‡¶æ‡¶Æ</div>
                <div class="sub">Member Identity Card</div>
              </div>
            </div>
            <div class="meta">
              <div>Member ID: <span id="memberId">‚Äî</span></div>
              <div>‡¶ú‡¶®‡ßç‡¶Æ ‡¶§‡¶æ‡¶∞‡¶ø‡¶ñ: <span id="cDob">‚Äî</span></div>
            </div>
            <div class="body">
              <div class="photo" id="cPhoto">‡¶õ‡¶¨‡¶ø</div>
              <div>
                <div class="row2"><div class="label">‡¶®‡¶æ‡¶Æ</div><div class="val" id="cName">‚Äî</div></div>
                <div class="row2"><div class="label">‡¶™‡¶ø‡¶§‡¶æ‡¶∞ ‡¶®‡¶æ‡¶Æ</div><div class="val" id="cFather">‚Äî</div></div>
                <div class="row2"><div class="label">‡¶ú‡¶æ‡¶§‡ßÄ‡ßü ‡¶™‡¶∞‡¶ø‡¶ö‡ßü</div><div class="val" id="cNid">‚Äî</div></div>
                <div class="row2"><div class="label">‡¶∞‡¶ï‡ßç‡¶§‡ßá‡¶∞ ‡¶ó‡ßç‡¶∞‡ßÅ‡¶™</div><div class="val" id="cBlood">‚Äî</div></div>
                <div class="row2"><div class="label">‡¶Æ‡ßã‡¶¨‡¶æ‡¶á‡¶≤</div><div class="val" id="cMobile">‚Äî</div></div>
                <div class="row2"><div class="label">‡¶†‡¶ø‡¶ï‡¶æ‡¶®‡¶æ</div><div class="val" id="cAddress">‚Äî</div></div>
              </div>
            </div>
            <div class="signs">
              <div class="sign"><img id="pSignImg" style="display:none"><div id="pSignPh" style="opacity:.8">‡¶∏‡ßç‡¶¨‡¶æ‡¶ï‡ßç‡¶∑‡¶∞</div><div class="line">‡¶∏‡¶≠‡¶æ‡¶™‡¶§‡¶ø</div></div>
              <div class="sign"><img id="sSignImg" style="display:none"><div id="sSignPh" style="opacity:.8">‡¶∏‡ßç‡¶¨‡¶æ‡¶ï‡ßç‡¶∑‡¶∞</div><div class="line">‡¶∏‡ßá‡¶ï‡ßç‡¶∞‡ßá‡¶ü‡¶æ‡¶∞‡¶ø</div></div>
              <div class="sign"><img id="mSignImg" style="display:none"><div id="mSignPh" style="opacity:.8">‡¶∏‡ßç‡¶¨‡¶æ‡¶ï‡ßç‡¶∑‡¶∞</div><div class="line">‡¶∏‡¶¶‡¶∏‡ßç‡¶Ø</div></div>
            </div>
          </div>
        </div>

        <div class="actions no-print">
          <button class="primary" id="btnPrint" disabled>Print / PDF</button>
          <button class="ghost" id="btnPNG" disabled>Download PNG</button>
          <button class="ghost" id="btnPNGTab" disabled>Open PNG in New Tab</button>
        </div>
        <div class="hint no-print">Print ‡¶ï‡¶æ‡¶ú ‡¶®‡¶æ ‡¶ï‡¶∞‡¶≤‡ßá Download PNG / Open PNG in New Tab ‡¶¨‡ßç‡¶Ø‡¶¨‡¶π‡¶æ‡¶∞ ‡¶ï‡¶∞‡ßÅ‡¶®‡•§</div>
      </div>
    </div>
  </div>

<script>
  function $(id){ return document.getElementById(id); }

  // Google Sheet URL store
  const SHEET_KEY = 'hfsyf_sheet_url';
  function getSheetURL(){ return localStorage.getItem(SHEET_KEY)||''; }
  function ensureSheetBar(){ if(!getSheetURL()){ $('#sheetBar').style.display='flex'; } }
  document.addEventListener('DOMContentLoaded', ensureSheetBar);
  document.getElementById('sheetSave').addEventListener('click', () => {
    const v = ($('#sheetInput').value||'').trim();
    if(v.startsWith('http')){
      localStorage.setItem(SHEET_KEY, v);
      $('#sheetBar').style.display='none';
      alert('Google Sheet URL saved! ‡¶è‡¶ñ‡¶® ‡¶•‡ßá‡¶ï‡ßá ‡¶∏‡¶æ‡¶¨‡¶Æ‡¶ø‡¶ü ‡¶ï‡¶∞‡¶≤‡ßá ‡¶∂‡¶ø‡¶ü‡ßá ‡¶Ø‡¶æ‡¶¨‡ßá‡•§');
    }else{
      alert('‡¶∏‡¶†‡¶ø‡¶ï Web App URL ‡¶¶‡¶ø‡¶® (https://script.google.com/.../exec)');
    }
  });

  function nextSerial(){
    var k='hfsyf_serial';
    var c=parseInt(localStorage.getItem(k)||'100',10);
    if(isNaN(c)) c=100;
    c += 1;
    localStorage.setItem(k,String(c));
    return c;
  }
  function genMemberId(){
    var d=new Date();
    var y=d.getFullYear(), m=('0'+(d.getMonth()+1)).slice(-2), dd=('0'+d.getDate()).slice(-2);
    var s=('000'+nextSerial()).slice(-3);
    return 'HFSYF-'+y+m+dd+'-'+s;
  }

  function readAsDataURL(input, cb){
    if(!input || !input.files || !input.files[0]){ cb(''); return; }
    var r=new FileReader(); r.onload=function(e){ cb(e.target.result); }; r.readAsDataURL(input.files[0]);
  }
  function enable(el, v){ el.disabled = !v; }

  var submitted=false;

  document.getElementById('memberForm').addEventListener('submit', function(e){
    e.preventDefault();
    var fd=new FormData(e.target);
    $('#cName').textContent   = (fd.get('fullName')||'').trim() || '‚Äî';
    $('#cFather').textContent = (fd.get('fatherName')||'').trim() || '‚Äî';
    $('#cDob').textContent    = (fd.get('dob')||'') || '‚Äî';
    $('#cNid').textContent    = (fd.get('nid')||'').trim() || '‚Äî';
    $('#cBlood').textContent  = (fd.get('blood')||'').trim() || '‚Äî';
    $('#cMobile').textContent = (fd.get('mobile')||'').trim() || '‚Äî';
    $('#cAddress').textContent= (fd.get('address')||'').trim() || '‚Äî';
    $('#memberId').textContent= genMemberId();

    readAsDataURL($('#photo'), function(u){ $('#cPhoto').innerHTML = u ? '<img src="'+u+'" alt="photo">' : '‡¶õ‡¶¨‡¶ø'; });
    readAsDataURL($('#logo'),  function(u){
      if(u){ $('#badge').style.background='#fff'; $('#badge').innerHTML='<img src="'+u+'" style="max-width:34px;max-height:34px;object-fit:contain" alt="logo">'; }
      else { $('#badge').style.background='rgba(255,255,255,.25)'; $('#badge').textContent='HF'; }
    });
    readAsDataURL($('#signPresident'), function(u){ if(u){ $('#pSignImg').src=u; $('#pSignImg').style.display='block'; $('#pSignPh').style.display='none'; } else { $('#pSignImg').removeAttribute('src'); $('#pSignImg').style.display='none'; $('#pSignPh').style.display='block'; } });
    readAsDataURL($('#signSecretary'), function(u){ if(u){ $('#sSignImg').src=u; $('#sSignImg').style.display='block'; $('#sSignPh').style.display='none'; } else { $('#sSignImg').removeAttribute('src'); $('#sSignImg').style.display='none'; $('#sSignPh').style.display='block'; } });
    readAsDataURL($('#signMember'),    function(u){ if(u){ $('#mSignImg').src=u; $('#mSignImg').style.display='block'; $('#mSignPh').style.display='none'; } else { $('#mSignImg').removeAttribute('src'); $('#mSignImg').style.display='none'; $('#mSignPh').style.display='block'; } });

    submitted = true;
    enable($('#btnPrint'), true); enable($('#btnPNG'), true); enable($('#btnPNGTab'), true);
    $('#idCard').scrollIntoView({behavior:'smooth', block:'center'});

    const sheetUrl = getSheetURL();
    if(sheetUrl){
      const payload = {
        memberId: $('#memberId').textContent || '',
        fullName: (fd.get('fullName')||'').trim(),
        fatherName: (fd.get('fatherName')||'').trim(),
        dob: fd.get('dob')||'',
        nid: (fd.get('nid')||'').trim(),
        blood: (fd.get('blood')||'').trim(),
        mobile: (fd.get('mobile')||'').trim(),
        address: (fd.get('address')||'').trim()
      };
      fetch(sheetUrl, {
        method: 'POST', mode: 'no-cors',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify(payload)
      }).catch(()=>{});
    } else {
      alert('Google Sheet URL ‡¶∏‡ßá‡¶ü ‡¶ï‡¶∞‡¶æ ‡¶®‡ßá‡¶á‡•§ ‡¶â‡¶™‡¶∞‡ßá ‡¶π‡¶≤‡ßÅ‡¶¶ ‡¶¨‡¶ï‡ßç‡¶∏‡ßá Apps Script Web App URL ‡¶™‡ßá‡¶∏‡ßç‡¶ü ‡¶ï‡¶∞‡ßá Save ‡¶ï‡¶∞‡ßÅ‡¶®‡•§');
      $('#sheetBar').style.display='flex';
    }
  });

  $('#btnPrint').addEventListener('click', function(){
    if(!submitted) return;
    setTimeout(function(){ window.print(); }, 50);
  });

  function nodeToPNG(cb){
    var node=$('#idCard'); var r=node.getBoundingClientRect(); var w=r.width, h=r.height, scale=3;
    var xml=new XMLSerializer().serializeToString(node);
    var svg='<svg xmlns="http://www.w3.org/2000/svg" width="'+(w*scale)+'" height="'+(h*scale)+'">'+
            '<foreignObject x="0" y="0" width="'+(w*scale)+'" height="'+(h*scale)+'" transform="scale('+scale+')">'+
            xml+'</foreignObject></svg>';
    var blob=new Blob([svg],{type:'image/svg+xml;charset=utf-8'}); var url=URL.createObjectURL(blob); var img=new Image();
    img.onload=function(){
      var c=document.createElement('canvas'); c.width=Math.floor(w*scale); c.height=Math.floor(h*scale);
      var ctx=c.getContext('2d');
      var g=ctx.createLinearGradient(0,0,c.width,c.height); g.addColorStop(0,'#4f46e5'); g.addColorStop(1,'#2563eb');
      ctx.fillStyle=g; ctx.fillRect(0,0,c.width,c.height);
      ctx.drawImage(img,0,0);
      URL.revokeObjectURL(url);
      try{ cb(c.toDataURL('image/png')); }catch(e){ cb(''); }
    };
    img.onerror=function(){ cb(''); };
    img.src=url;
  }

  function downloadDataUrl(png, name){
    try{
      var a=document.createElement('a');
      if(typeof a.download==='undefined'){ window.open(png,'_blank'); return; }
      a.href=png; a.download=name; document.body.appendChild(a); a.click(); a.remove();
    }catch(e){ window.open(png,'_blank'); }
  }

  $('#btnPNG').addEventListener('click', function(){
    if(!submitted) return;
    nodeToPNG(function(png){
      if(png){ downloadDataUrl(png, ($('#memberId').textContent||'card')+'.png'); }
      else{ alert('PNG ‡¶§‡ßà‡¶∞‡¶ø ‡¶ï‡¶∞‡¶æ ‡¶ó‡ßá‡¶≤ ‡¶®‡¶æ‡•§ ‡¶Ö‡¶®‡ßÅ‡¶ó‡ßç‡¶∞‡¶π ‡¶ï‡¶∞‡ßá Google Chrome/Edge ‡¶¨‡ßç‡¶Ø‡¶¨‡¶π‡¶æ‡¶∞ ‡¶ï‡¶∞‡ßÅ‡¶®‡•§'); }
    });
  });

  $('#btnPNGTab').addEventListener('click', function(){
    if(!submitted) return; nodeToPNG(function(png){ if(png){ window.open(png,'_blank'); } });
  });
</script>
</body>
</html>
